var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(e){var r=document.getElementById(e),t=r.querySelector(".listening"),i=r.querySelector(".received");t.setAttribute("style","display:none;"),i.setAttribute("style","display:block;"),console.log("Received Event: "+e),setTimeout(function(){alert("Started 3!")},0),qr.scanner=$("#scanner").addClass("inactive"),qr.recpause=$("#recpause").addClass("pause"),qr.max_width=500,qr.max_height=500,qr.capture_interval=500,qr.failed_scans=0,qr.init()}},qr={scanner:null,recpause:null,max_width:500,max_height:500,capture_interval:500,failed_scans:0,isCanvasSupported:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},get_sources:function(e){for(var r=0;r!==e.length;++r){var t=e[r],i=document.createElement("option");i.value=t.id,"audio"===t.kind||"video"===t.kind&&(i.text=t.label||"Camera "+(qr.video_select.length+1),qr.video_select.appendChild(i))}},init:function(){qr.has_gum=navigator.getMedia?!0:!1,qr.has_canvas=qr.isCanvasSupported(),qr.go=qr.has_gum&&qr.has_canvas,qr.is_streaming=!1,qr.video_select=$("#qr_video_source").get(0),qr.cnv=$("#qr_canvas").get(0),qr.ctx=qr.cnv.getContext("2d"),"undefined"==typeof MediaStreamTrack||"undefined"==typeof MediaStreamTrack.getSources?qr.select_source=!1:(qr.select_source=!0,MediaStreamTrack.getSources(qr.get_sources)),qr.recpause.click(function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).toggleClass("pause"),$(this).hasClass("pause")?qr.stop():qr.start()})},start:function(){if(qr.go){if(qr.recpause.removeClass("pause"),qr.select_source)var e={timeout:15e3,source_id:qr.video_select.value};else var e={timeout:15e3};GumHelper.startVideoStreaming(function(e,r,t,i,s){if(e)qr.stop(),alert(e);else{qr.scanner.removeClass("inactive"),qr.is_streaming=!0,qr.video_stream=r,qr.video_element=t,qr.video_width=i,qr.video_height=s,qr.video_element.muted=!0;var a=$(qr.video_element).attr("id","qr_video");$("#qr_video").replaceWith(a),$(qr.video_element).addClass("show"),qr.cnv.width=qr.max_width=$(qr.video_element).width(),qr.cnv.height=qr.max_height=$(qr.video_element).height();var q=qr.max_width/qr.max_height,n=qr.video_width/qr.video_height,d=qr.video_width>qr.max_width,o=qr.video_height>qr.max_height,c=d&&o,h=d||o;qr.sx=0,qr.sy=0,qr.x=0,qr.y=0,n>q?c?(qr.sh=qr.video_height,qr.sw=q*qr.sh,qr.sx=qr.video_width/2-qr.sw/2,qr.sy=qr.video_height/2-qr.sh/2,qr.w=qr.max_width,qr.h=qr.max_height):h?(qr.sw=qr.max_width,qr.sh=qr.video_height,qr.sx=qr.video_width/2-qr.sw/2,qr.w=qr.sw,qr.h=qr.sh,qr.y=qr.max_height/2-qr.sh/2):(qr.sw=qr.video_width,qr.sh=qr.video_height,qr.w=qr.sw,qr.h=qr.sh,qr.x=qr.max_width/2-qr.sw/2,qr.y=qr.max_height/2-qr.sh/2):c?(qr.sw=qr.video_width,qr.sh=qr.sw/q,qr.sx=qr.video_width/2-qr.sw/2,qr.sy=qr.video_height/2-qr.sh/2,qr.w=qr.max_width,qr.h=qr.max_height):h?(qr.sw=qr.video_width,qr.sh=qr.max_height,qr.sy=qr.video_height/2-qr.sh/2,qr.w=qr.sw,qr.h=qr.sh,qr.x=qr.max_width/2-qr.sw/2):(qr.sw=qr.video_width,qr.sh=qr.video_height,qr.w=qr.sw,qr.h=qr.sh,qr.x=qr.max_width/2-qr.sw/2,qr.y=qr.max_height/2-qr.sh/2),setTimeout(qr.capture,qr.capture_interval)}},e)}else qr.recpause.addClass("pause"),alert("Canvas or getUserMedia is not available.\n\nPlease try Chrome browser.")},stop:function(){GumHelper.stopVideoStreaming(),qr.is_streaming=!1,qr.scanner.removeClass("error success fail processing").addClass("inactive"),qr.recpause.addClass("pause")},resume:function(){qr.scanner.removeClass("error success fail"),$(qr.cnv).removeClass("show"),setTimeout(qr.capture,qr.capture_interval)},capture:function(){if(qr.is_streaming){qr.scanner.addClass("processing");try{qr.ctx.clearRect(0,0,qr.cnv.width,qr.cnv.height),$(qr.cnv).addClass("show"),qr.ctx.drawImage(qr.video_element,qr.sx,qr.sy,qr.sw,qr.sh,qr.x,qr.y,qr.w,qr.h);try{var e=qr.cnv.toDataURL();qrcode.decode(e)}catch(r){console.log(r),setTimeout(qr.capture,qr.capture_interval)}}catch(r){console.log(r),setTimeout(qr.capture,qr.capture_interval)}}}};app.initialize();